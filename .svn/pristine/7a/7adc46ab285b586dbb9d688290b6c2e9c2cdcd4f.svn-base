#!/usr/bin/python
#coding=utf-8

from pyexcel_xlsx import get_data
import random,re,os,time,urllib2
import json
import mysql.connector
from mysql.connector import errorcode


ds={
"host":'localhost',
'port':3306,
'user':'root',
'db':'llidc',
'passwd':"zxgj0313"
}
def parser():
    f = get_data("D:\\mywork\\llidc\\script\\allmachines.xlsx")
    for i in f["dongguan"]:
        yield i

cnx = cur = None
try:
    cnx = mysql.connector.connect(**ds)
except mysql.connector.Error as err:
    if err.errno == errorcode.ER_ACCESS_DENIED_ERROR:
        print('Something is wrong with your user name or password')
    elif err.errno == errorcode.ER_BAD_DB_ERROR:
        print("Database does not exist")
    else:
        print(err)
else:
    cur = cnx.cursor()
    
    for a in parser():
        j=[]
        for k in a:
            if k:
                if isinstance(k,unicode):
                    j.append(k.encode("utf-8"))
                else:
                    j.append(k)
            else:
                j.append("")

        values = (j[4],j[0],j[1],j[2],j[3],j[5],j[9],j[6],j[10],j[8],j[7])
        sql = "insert into llidc_machines (m_ip,m_idc_location,m_cabinet_num,m_num,m_num_wy,m_config,m_client,m_bandwidth,m_status,m_operator,m_memo) values('%s','%s','%s','%s','%s','%s','%s','%s','%s','%s','%s')"%values
        print sql
        cur.execute(sql)
        print "inserted sql:%s"%sql
finally:
    if cur:
        cnx.commit()
        cur.close()
    if cnx:
        cnx.close()



        




    
    #print values
    
print "finished all"
